import{S as t,i as e,h as n,j as a,m as s,t as o,k as c,l as r,_ as i,aa as d,J as u,y as l,O as $,n as p,x as f,ac as m,L as g,ad as h,M as x,p as w,ap as y,aq as v}from"./vendor.6ce12853.js";import{P as k}from"./page-container.ffd52571.js";import{u as b,g as j,b as z,C as q,W as C,c as L,r as P,d as R}from"./index.a80689dd.js";function S(t){let e;return{c(){e=u("div"),l(e,"id","canvas-container"),l(e,"class","content-container absolute inset-0 svelte-1lg75l6")},m(n,a){$(n,e,a),t[6](e)},p:p,d(n){n&&f(e),t[6](null)}}}function D(t){let e;return{c(){e=x("导出图片")},m(t,n){$(t,e,n)},d(t){t&&f(e)}}}function E(t){let e;return{c(){e=x("返回")},m(t,n){$(t,e,n)},d(t){t&&f(e)}}}function W(t){let e,n,i,d;return e=new m({props:{size:"small",$$slots:{default:[D]},$$scope:{ctx:t}}}),e.$on("click",t[3]),i=new m({props:{kind:"secondary",size:"small",$$slots:{default:[E]},$$scope:{ctx:t}}}),i.$on("click",t[4]),{c(){a(e.$$.fragment),n=g(),a(i.$$.fragment)},m(t,a){s(e,t,a),$(t,n,a),s(i,t,a),d=!0},p(t,n){const a={};32768&n&&(a.$$scope={dirty:n,ctx:t}),e.$set(a);const s={};32768&n&&(s.$$scope={dirty:n,ctx:t}),i.$set(s)},i(t){d||(o(e.$$.fragment,t),o(i.$$.fragment,t),d=!0)},o(t){c(e.$$.fragment,t),c(i.$$.fragment,t),d=!1},d(t){r(e,t),t&&f(n),r(i,t)}}}function J(t){let e,n;return e=new k({props:{title:"页面预览",layout:"workspace",$$slots:{action:[W],default:[S]},$$scope:{ctx:t}}}),{c(){a(e.$$.fragment)},m(t,a){s(e,t,a),n=!0},p(t,[n]){const a={};32769&n&&(a.$$scope={dirty:n,ctx:t}),e.$set(a)},i(t){n||(o(e.$$.fragment,t),n=!0)},o(t){c(e.$$.fragment,t),n=!1},d(t){r(e,t)}}}function M(t,e,n){let a,s,o,{router:c}=e;const{stage:r,page:u,dispatch:l,zoom:$}=b((t=>t.editor));function p(t){window.addEventListener("resize",(()=>P(t)))}function f(){l("updatePreview",!0),l("updateZoom",1),l("updateSelected",[])}return i(t,r,(t=>n(7,a=t))),i(t,$,(t=>n(8,s=t))),d((()=>{const{id:t}=c.currentRoute.query;!function(){const t=L(o);y(v(R),v(p),v(P),v(f))(t)}(),t&&function(t){q.get().database().collection("pages").doc(t).get().then((({data:t})=>{const[e]=t;e&&(l("updatePage",e.page),l("updateWidgets",w(C,e.widgets)),setTimeout((()=>{l("renderStage")}),500))}))}(t)})),t.$$set=t=>{"router"in t&&n(5,c=t.router)},[o,r,$,function(){const{content:t}=j(),e=t.clip().width/z.editor.content.scale*s,n=t.clip().height/z.editor.content.scale*s;((t,e)=>{const n=document.createElement("a");n.download=e,n.href=t,document.body.appendChild(n),n.click(),document.body.removeChild(n)})(a.toDataURL({width:e,height:n,x:t.x(),y:t.y(),pixelRatio:z.editor.content.scale,quality:1}),`${Date.now()}.png`)},function(){c.push("/page-center")},c,function(t){h[t?"unshift":"push"]((()=>{o=t,n(0,o)}))}]}class O extends t{constructor(t){super(),e(this,t,M,J,n,{router:5})}}export{O as default};
