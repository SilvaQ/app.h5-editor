import{S as t,i as e,h as a,j as s,m as n,t as o,k as c,l as r,_ as i,aa as d,J as u,y as l,O as p,n as $,x as m,ac as f,ad as g,M as h,p as x,ar as w,as as y}from"./vendor.82638a67.js";import{P as v}from"./page-container.9bade357.js";import{u as b,g as j,b as k,C as z,W as C,c as P,r as R,d as S}from"./index.83e21236.js";function q(t){let e;return{c(){e=u("div"),l(e,"id","canvas-container"),l(e,"class","content-container absolute inset-0 svelte-1lg75l6")},m(a,s){p(a,e,s),t[5](e)},p:$,d(a){a&&m(e),t[5](null)}}}function E(t){let e;return{c(){e=h("导出图片")},m(t,a){p(t,e,a)},d(t){t&&m(e)}}}function L(t){let e,a;return e=new f({props:{size:"small",$$slots:{default:[E]},$$scope:{ctx:t}}}),e.$on("click",t[3]),{c(){s(e.$$.fragment)},m(t,s){n(e,t,s),a=!0},p(t,a){const s={};16384&a&&(s.$$scope={dirty:a,ctx:t}),e.$set(s)},i(t){a||(o(e.$$.fragment,t),a=!0)},o(t){c(e.$$.fragment,t),a=!1},d(t){r(e,t)}}}function W(t){let e,a;return e=new v({props:{title:"页面预览",layout:"workspace",$$slots:{action:[L],default:[q]},$$scope:{ctx:t}}}),{c(){s(e.$$.fragment)},m(t,s){n(e,t,s),a=!0},p(t,[a]){const s={};16385&a&&(s.$$scope={dirty:a,ctx:t}),e.$set(s)},i(t){a||(o(e.$$.fragment,t),a=!0)},o(t){c(e.$$.fragment,t),a=!1},d(t){r(e,t)}}}function D(t,e,a){let s,n,o,{router:c}=e;const{stage:r,page:u,dispatch:l,zoom:p}=b((t=>t.editor));function $(t){window.addEventListener("resize",(()=>R(t)))}function m(){l("updatePreview",!0),l("updateZoom",1),l("updateSelected",[])}return i(t,r,(t=>a(6,s=t))),i(t,p,(t=>a(7,n=t))),d((()=>{const{id:t}=c.currentRoute.query;!function(){const t=P(o);w(y(S),y($),y(R),y(m))(t)}(),t&&function(t){z.get().database().collection("pages").doc(t).get().then((({data:t})=>{const[e]=t;e&&(l("updatePage",e.page),l("updateWidgets",x(C,e.widgets)),setTimeout((()=>{l("renderStage")}),500))}))}(t)})),t.$$set=t=>{"router"in t&&a(4,c=t.router)},[o,r,p,function(){const{content:t}=j(),e=t.clip().width/k.editor.content.scale*n,a=t.clip().height/k.editor.content.scale*n;((t,e)=>{const a=document.createElement("a");a.download=e,a.href=t,document.body.appendChild(a),a.click(),document.body.removeChild(a)})(s.toDataURL({width:e,height:a,x:t.x(),y:t.y(),pixelRatio:k.editor.content.scale,quality:1}),"stage.png")},c,function(t){g[t?"unshift":"push"]((()=>{o=t,a(0,o)}))}]}class J extends t{constructor(t){super(),e(this,t,D,W,a,{router:4})}}export{J as default};
