var t=Object.defineProperty,e=Object.defineProperties,n=Object.getOwnPropertyDescriptors,r=Object.getOwnPropertySymbols,o=Object.prototype.hasOwnProperty,s=Object.prototype.propertyIsEnumerable,a=(e,n,r)=>n in e?t(e,n,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[n]=r,i=(t,e)=>{for(var n in e||(e={}))o.call(e,n)&&a(t,n,e[n]);if(r)for(var n of r(e))s.call(e,n)&&a(t,n,e[n]);return t},c=(t,r)=>e(t,n(r));import{T as d,c as l,K as u,a as f,p,b as g,d as h,e as m,u as w,f as y,S as $,i as b,s as v,R as x,g as k,m as E,n as O,t as P,h as _,j,k as L,l as T,o as S,q as A,r as C,v as I,w as W,x as X,y as z,z as D,A as N,E as B,B as M,C as R,D as V,F as Y,G as H,H as q,I as F,J as K,L as U,M as G,N as Z,O as J,P as Q,Q as tt,U as et,V as nt,W as rt,X as ot}from"./vendor.fa198a46.js";const st={ready:!1,layout:"default"},at={keys:Object.keys(st),module:t=>{t.on("@init",(()=>st)),t.on("ready",(()=>({ready:!0}))),t.on("updateLayout",((t,e)=>c(i({},t),{layout:e})))}};var it,ct,dt,lt,ut,ft;(ct=it||(it={})).image="IMAGE",ct.text="TEXT",(dt||(dt={})).username="USERNAME",(lt||(lt={})).input="input",(ft=ut||(ut={})).stage="stage",ft.widget="widget";class pt{}class gt{}var ht=Object.defineProperty,mt=Object.getOwnPropertyDescriptor;class wt{get id(){return this.property.id}}((t,e,n,r)=>{for(var o,s=r>1?void 0:r?mt(e,n):e,a=t.length-1;a>=0;a--)(o=t[a])&&(s=(r?o(e,n,s):o(s))||s);r&&s&&ht(e,n,s)})([d((()=>gt))],wt.prototype,"property",2);var yt=Object.defineProperty,$t=Object.getOwnPropertyDescriptor;class bt extends wt{constructor(){super(...arguments),this.widgetType=it.text}}((t,e,n,r)=>{for(var o,s=r>1?void 0:r?$t(e,n):e,a=t.length-1;a>=0;a--)(o=t[a])&&(s=(r?o(e,n,s):o(s))||s);r&&s&&yt(e,n,s)})([d((()=>pt))],bt.prototype,"textProperty",2);const vt={[it.text]:function(t="请输入文本",e){const n=new bt;return n.quoteType=e,n.property=function(){const t=new gt;return t.id=Math.random().toString(32).slice(2),t.height=100,t.width=100,t.opacity=1,t.rotation=0,t.scaleX=1,t.scaleY=1,t.x=0,t.y=0,t}(),n.textProperty=function(t){const e=new pt;return e.fill="#000",e.fontFamily="Arial",e.align="left",e.fontSize=14,e.fontStyle="",e.text=t,e}(t),n}};function xt(t){const e=l(t);return e.property.id=Math.random().toString(32).slice(2),e}const kt={content:{width:360,height:640}},Et={Text:function(t){t.on(lt.input,(()=>{!function(t,e){const{widgets:n}=re.get(),r=n.find((e=>e.id===t.id()));if(!r)return;re.dispatch("updateWidget",{id:r.id,textProperty:i(i({},r.textProperty),e)})}(t,{text:t.text()})}))},Image:function(){}};function Ot(t,e){const{widgets:n}=re.get(),r=n.find((e=>e.id===t.id()));r&&re.dispatch("updateWidget",{id:r.id,property:i(i({},r.property),e)})}function Pt(t){const e=t.container(),{content:n}=jt(),{width:r,height:o}=kt.content;t.width(e.offsetWidth),t.height(e.offsetHeight),n.x(e.offsetWidth/2-r*n.scaleX()/2),n.y(e.offsetHeight/2-o*n.scaleY()/2),n.draw()}function _t(t){const e=t.clientWidth,n=t.clientHeight,r=new u.Stage({container:t,width:e,height:n}),{content:o,background:s}=function(t){const{width:e,height:n}=kt.content,r=new u.Layer({name:"content",x:t.width()/2-e/2,y:t.height()/2-n/2,clip:{x:0,y:0,width:e,height:n}}),o=new u.Layer({name:"background"});return{content:r,background:o}}(r);return r.add(o),r.add(s),o.draw(),s.draw(),re.dispatch("updateStage",r),r}function jt(){const{stage:t}=re.get();if(!t)throw"请初始化Stage";const e=t.getLayers();return{content:e.find((t=>"content"===t.name())),background:e.find((t=>"background"===t.name()))}}const Lt=["background"],Tt={Text:["top-center","bottom-center","middle-right","middle-left"],Image:["top-left","top-right","bottom-left","bottom-right"],default:["top-left","top-right","bottom-left","bottom-right"]};function St(t){return t.find("Transformer").find((t=>"selected"===t.name()))}function At(t,e){return t.find("Transformer").find((t=>t.nodes().includes(e)))}function Ct(t,e,n=!1){const r=new u.Transformer({keepRatio:!0,resizeEnabled:n,rotateEnabled:n});var o;e instanceof u.Node&&r.enabledAnchors((o=e.getClassName(),Tt[o]||Tt.default));const s=e instanceof u.Node?[e]:e;return r.nodes(s),t.add(r),t.draw(),r}function It(t){t.find("Transformer").forEach((t=>t.destroy())),t.draw()}function Wt(t){const{content:e}=jt();t.on("mousedown",(n=>{if(n.target===t)return void It(t);e.findOne((t=>Lt.includes(n.target.name())))&&It(t)}))}function Xt(t){const e=t.getLayer().getLayer(),n=e.offsetX()+t.absolutePosition().x,r=e.offsetY()+t.absolutePosition().y,o=document.createElement("textarea");document.getElementById("convas-container").appendChild(o),o.value=t.text(),o.style.position="absolute",o.style.top=r+"px",o.style.left=n+"px",o.style.width=t.width()-2*t.padding()+"px",o.style.height=t.height()-2*t.padding()+5+"px",o.style.fontSize=`${t.fontSize()}px`,o.style.border="none",o.style.padding="0px",o.style.margin="0px",o.style.overflow="hidden",o.style.background="none",o.style.outline="none",o.style.resize="none",o.style.wordBreak="break-all",o.style.fontFamily=t.fontFamily(),o.style.transformOrigin="left top",o.style.textAlign=t.align(),o.style.color=t.fill(),o.style.transform=`rotateZ(${t.rotation()}deg)`,o.focus(),o.addEventListener("keydown",(function(t){"Enter"!==t.key||t.shiftKey||o.blur()})),o.addEventListener("blur",(function(e){t.text(o.value),t.fire(lt.input),o.parentNode.removeChild(o),t.show()}))}const zt={[it.text]:function(t){const e=new u.Text(i(i({},t.property),t.textProperty));return function(t){t.on("dblclick dbltap",(()=>{t.hide(),Xt(t)}))}(e),function(t){t.on("transform",(e=>{t.setAttrs({width:Math.max(t.width()*t.scaleX(),100),height:Math.max(t.height()*t.scaleY(),50),scaleX:1,scaleY:1})}))}(e),e}};function Dt(t){const e=(0,zt[t.widgetType])(t);return e.draggable(!0),e}function Nt(t,e,n=!0){const{content:r,background:o}=jt();!function(t,e){const{background:n}=jt();e.on("mouseenter",(r=>{At(t,e)||Ct(n,e,!1)})),e.on("mouseout",(n=>{const r=At(t,e);r&&"selected"!==r.name()&&r.destroy()})),e.on("mousedown",(r=>{const o=St(t),s=At(t,e);if(s&&s===o)return;const a=r.evt.ctrlKey&&o?[...o.nodes(),e]:e;It(t),Ct(n,a,a instanceof u.Node).name("selected")}))}(t,e),It(t),n&&Ct(o,e,!0),function(t){t.on("transformend",(()=>{Ot(t,{width:t.width(),height:t.height(),scaleX:t.scaleX(),scaleY:t.scaleY()})})),t.on("dragend",(()=>{Ot(t,{x:t.x(),y:t.y()})}));const e=Et[t.getClassName()];e&&e(t)}(e),r.add(e)}function Bt(t){const e=St(t);if(!e)return;return e.getNodes().filter((t=>t.visible()))}function Mt(){const{content:t}=jt(),{width:e,height:n}=kt.content,r=new u.Rect({width:e,height:n,fill:"#fff",name:"background"});t.add(r)}function Rt(t){const e=f(t.widgets);return t.history.forward=[],t.history.backward.push({type:ut.widget,data:e}),{history:{forward:t.history.forward,backward:t.history.backward}}}function Vt(t){return{widgets:p(wt,t.data)}}function Yt(t){return{type:ut.widget,data:f(t.widgets)}}function Ht(t,e){return{[ut.widget]:Rt}[t](e)}function qt(t){const e=t.history.backward.pop();if(!e)return;const n={[ut.widget]:Vt},r={[ut.widget]:Yt};return c(i({},n[e.type](e)),{history:{backward:[...t.history.backward],forward:[...t.history.forward,r[e.type](t)]}})}function Ft(t){const e=t.history.forward.pop();if(!e)return;const n={[ut.widget]:Vt},r={[ut.widget]:Yt};return c(i({},n[e.type](e)),{history:{backward:[...t.history.backward,r[e.type](t)],forward:[...t.history.forward]}})}const Kt={stage:void 0,selected:[],zoom:1,widgets:[],history:{backward:[],forward:[]}};g(Ht)(ut.stage);const Ut={keys:Object.keys(Kt),module:t=>{t.on("@init",(()=>Kt)),t.on("updateStage",((t,e)=>c(i({},t),{stage:e}))),t.on("updateWidgets",((t,e)=>c(i({},t),{widget:e}))),t.on("updateSelected",((t,e)=>c(i({},t),{selected:e}))),t.on("updateWidget",se(Zt,{before:[g(Ht)(ut.widget)]})),t.on("updateZoom",se(Gt)),t.on("backward",se(qt,{after:[te]})),t.on("forward",se(Ft,{after:[te]})),t.on("createWidget",se(Jt,{before:[g(Ht)(ut.widget)]})),t.on("deleteWidget",se(Qt,{before:[g(Ht)(ut.widget)]}))}};function Gt(t,e){const{content:n}=jt();return n.scaleX(e),n.scaleY(e),Pt(t.stage),{zoom:e}}function Zt(t,e){const n=t.widgets.find((t=>t.id===e.id));return n&&Object.entries(e).forEach((([t,r])=>{"id"!==t&&(n[t]=i(i({},n[t]),e[t]))})),{widgets:t.widgets}}function Jt(t,e){const{stage:n,widgets:r}=t,o=e instanceof wt?e:(s=it.text,(0,vt[s])());var s;return Nt(n,Dt(o)),{widgets:[...r,o]}}function Qt(t,e){const{stage:n}=t;return function(t,e){const{content:n}=jt(),[r]=n.getChildren((t=>t.id()===e));r&&(r.destroy(),It(t))}(n,e),{widgets:t.widgets.filter((t=>t.property.id!==e))}}function te(t){const{stage:e,widgets:n}=t,{content:r}=jt();var o;r.destroyChildren(),It(e),Mt(),(o=t.widgets,o.map((t=>Dt(t)))).forEach((t=>Nt(e,t,!1)))}const ee={userid:"",username:""},ne={user:{keys:Object.keys(ee),module:t=>{t.on("@init",(()=>ee)),t.on("login",((t,e)=>c(i({},t),{userid:e,username:e+":name"})))},persist:["userid"]},app:at,editor:Ut},re=h([...Object.values(ne).map((t=>t.module)),m(Object.values(ne).filter((t=>t.persist)).map((t=>t.persist)).flat())]);function oe(t){return w(...t(ne).keys)}function se(t,e={after:[],before:[]}){return(n,r)=>{const{before:o=[],after:s=[]}=e,a=o.reduce(((t,e)=>i(i({},t),e(t)||{})),n),c=i(i({},n),t(n,r)),d=s.reduce(((t,e)=>i(i({},t),e(t)||{})),c);return i(i(i({},a),c),d)}}const ae={"interactive-01":"#1890ff","layer-selected-inverse":"#1890ff"};function ie(t){let e,n;return e=new x({}),{c(){k(e.$$.fragment)},m(t,r){E(e,t,r),n=!0},p:O,i(t){n||(P(e.$$.fragment,t),n=!0)},o(t){_(e.$$.fragment,t),n=!1},d(t){j(e,t)}}}let ce;const de={},le=function(t,e){if(!e||0===e.length)return t();if(void 0===ce){const t=document.createElement("link").relList;ce=t&&t.supports&&t.supports("modulepreload")?"modulepreload":"preload"}return Promise.all(e.map((t=>{if((t=`/app.h5-editor/${t}`)in de)return;de[t]=!0;const e=t.endsWith(".css"),n=e?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${t}"]${n}`))return;const r=document.createElement("link");return r.rel=e?"stylesheet":ce,e||(r.as="script",r.crossOrigin=""),r.href=t,document.head.appendChild(r),e?new Promise(((t,e)=>{r.addEventListener("load",t),r.addEventListener("error",e)})):void 0}))).then((()=>t()))};function ue(t){let e,n,r=[{class:"icon"},{viewBox:"0 0 1024 1024"},{xmlns:"http://www.w3.org/2000/svg"},{width:"200"},{height:"200"},t[0]],o={};for(let s=0;s<r.length;s+=1)o=L(o,r[s]);return{c(){e=T("svg"),n=T("path"),this.h()},l(t){e=S(t,"svg",{class:!0,viewBox:!0,xmlns:!0,width:!0,height:!0},1);var r=A(e);n=S(r,"path",{d:!0,fill:!0},1),A(n).forEach(C),r.forEach(C),this.h()},h(){I(n,"d","m544 82.464 323.968 187.072a64 64 0 0 1 32 55.424v374.08a64 64 0 0 1-32 55.424L544 941.536a64 64 0 0 1-64 0L156.032 754.464a64 64 0 0 1-32-55.424V324.96a64 64 0 0 1 32-55.424L480 82.464a64 64 0 0 1 64 0zM810.56 336a32 32 0 0 0-40.384-13.408l-3.328 1.696L512 471.392 257.184 324.288a32 32 0 0 0-35.136 53.376l3.136 2.048L480 526.848V816a32 32 0 0 0 63.776 3.744L544 816V526.848l254.848-147.136A32 32 0 0 0 810.56 336z"),I(n,"fill","#B19C4A"),W(e,o)},m(t,r){X(t,e,r),z(e,n)},p(t,[n]){W(e,o=D(r,[{class:"icon"},{viewBox:"0 0 1024 1024"},{xmlns:"http://www.w3.org/2000/svg"},{width:"200"},{height:"200"},1&n&&t[0]]))},i:O,o:O,d(t){t&&C(e)}}}function fe(t,e,n){return t.$$set=t=>{n(0,e=L(L({},e),N(t)))},[e=N(e)]}class pe extends ${constructor(t){super(),b(this,t,fe,ue,v,{})}}const ge=[{path:"/",component:()=>le((()=>import("./login.8a4c0a5e.js")),["assets/login.8a4c0a5e.js","assets/vendor.fa198a46.js","assets/vendor.11618b7d.css","assets/page-container.1b925e22.js","assets/page-container.3a1c8316.css"]),name:"login"},{path:"/dashboard",component:()=>le((()=>import("./dashboard.e5bfaa52.js")),["assets/dashboard.e5bfaa52.js","assets/vendor.fa198a46.js","assets/vendor.11618b7d.css","assets/page-container.1b925e22.js","assets/page-container.3a1c8316.css"]),name:"dashboard",meta:{menu:{title:"仪表盘",icon:pe}}},{path:"/poster",component:()=>le((()=>import("./poster-center.0bc0e545.js")),["assets/poster-center.0bc0e545.js","assets/vendor.fa198a46.js","assets/vendor.11618b7d.css","assets/page-container.1b925e22.js","assets/page-container.3a1c8316.css"]),name:"poster-center",meta:{menu:{title:"海报中心",icon:pe}}},{path:"/editor",component:()=>le((()=>import("./editor.8e7abda0.js")),["assets/editor.8e7abda0.js","assets/editor.7aa1131d.css","assets/vendor.fa198a46.js","assets/vendor.11618b7d.css","assets/page-container.1b925e22.js","assets/page-container.3a1c8316.css"]),name:"editor"},{path:"/h5",component:()=>le((()=>import("./h5-center.7a353a0d.js")),["assets/h5-center.7a353a0d.js","assets/vendor.fa198a46.js","assets/vendor.11618b7d.css"]),name:"h5-center",meta:{menu:{title:"H5中心",icon:pe}}}];class he extends B{constructor(){super(...arguments),this.before=t=>{t.options.header=t.options.header||{},t.options.header["X-UserID"]="001"},this.after=(t,e)=>{}}}async function me(){M.setConfig({server:"http://api.test.com/",timeout:3e3}),M.interceptors.status.use((t=>!0)),M.interceptors.success.use((t=>t.data)),M.interceptors.error.use((t=>t)),M.requestCatchHandle=t=>{t&&((t.data||{}).message||t.status,403===t.status&&console.error(t.data))},M.installExtendService(new he),await Promise.all([Promise.resolve()])}const we=new R({mode:V,omitTrailingSlash:!0,base:"/app.h5-editor/",routes:ge});we.beforeEach((async(t,e,n)=>{const{ready:r}=re.get();r||(await me(),re.dispatch("ready")),n()}));function ye(t,e,n){const r=t.slice();return r[4]=e[n],r}function $e(t){let e,n,r,o,s,a,i,c,d,l=t[4].title+"";var u=t[4].icon;function f(){return t[3](t[4])}return u&&(n=new u({props:{width:28,height:28}})),{c(){e=Y("div"),n&&k(n.$$.fragment),r=H(),o=Y("div"),s=q(l),a=H(),I(o,"class","title text-xs pt-1"),I(e,"class","menu-item m-3 py-2 cursor-pointer active:bg-gray-100 hover:bg-gray-200 flex flex-col justify-center items-center rounded svelte-6ff0y4"),F(e,"active",t[4].name===t[0])},m(t,l){K(t,e,l),n&&E(n,e,null),U(e,r),U(e,o),U(o,s),U(e,a),i=!0,c||(d=G(e,"click",f),c=!0)},p(o,s){if(u!==(u=(t=o)[4].icon)){if(n){Z();const t=n;_(t.$$.fragment,1,0,(()=>{j(t,1)})),J()}u?(n=new u({props:{width:28,height:28}}),k(n.$$.fragment),P(n.$$.fragment,1),E(n,e,r)):n=null}3&s&&F(e,"active",t[4].name===t[0])},i(t){i||(n&&P(n.$$.fragment,t),i=!0)},o(t){n&&_(n.$$.fragment,t),i=!1},d(t){t&&C(e),n&&j(n),c=!1,d()}}}function be(t){let e,n,r,o,s,a,i,c=t[1],d=[];for(let u=0;u<c.length;u+=1)d[u]=$e(ye(t,c,u));const l=t=>_(d[t],1,1,(()=>{d[t]=null}));return{c(){e=Y("section"),n=Y("div");for(let t=0;t<d.length;t+=1)d[t].c();r=H(),o=Y("div"),o.textContent="2",s=H(),a=Y("div"),a.textContent="3",I(n,"class","menu flex-auto svelte-6ff0y4"),I(o,"class","toolbar svelte-6ff0y4"),I(a,"class","user"),I(e,"class","shadow-lg absolute inset-0 flex flex-col")},m(t,c){K(t,e,c),U(e,n);for(let e=0;e<d.length;e+=1)d[e].m(n,null);U(e,r),U(e,o),U(e,s),U(e,a),i=!0},p(t,[e]){if(7&e){let r;for(c=t[1],r=0;r<c.length;r+=1){const o=ye(t,c,r);d[r]?(d[r].p(o,e),P(d[r],1)):(d[r]=$e(o),d[r].c(),P(d[r],1),d[r].m(n,null))}for(Z(),r=c.length;r<d.length;r+=1)l(r);J()}},i(t){if(!i){for(let t=0;t<c.length;t+=1)P(d[t]);i=!0}},o(t){d=d.filter(Boolean);for(let e=0;e<d.length;e+=1)_(d[e]);i=!1},d(t){t&&C(e),Q(d,t)}}}function ve(t,e,n){let r;const o=ge.filter((t=>{var e;return null===(e=null==t?void 0:t.meta)||void 0===e?void 0:e.menu})).map((t=>({name:t.name,path:t.path,title:t.meta.menu.title,icon:t.meta.menu.icon})));function s(t){we.push(t)}we.currentMatched.subscribe((t=>{if(t&&t.length){const[e]=t;n(0,r=e.name)}}));return[r,o,s,t=>s(t.path)]}class xe extends ${constructor(t){super(),b(this,t,ve,be,v,{})}}function ke(t){let e,n,r,o,s,a,i;return r=new xe({}),a=new x({}),{c(){e=Y("main"),n=Y("div"),k(r.$$.fragment),o=H(),s=Y("div"),k(a.$$.fragment),I(n,"class","sidebar relative"),I(s,"class","content relative"),I(e,"class","absolute inset-0 grid grid-cols-2 svelte-15go9i5")},m(t,c){K(t,e,c),U(e,n),E(r,n,null),U(e,o),U(e,s),E(a,s,null),i=!0},p:O,i(t){i||(P(r.$$.fragment,t),P(a.$$.fragment,t),i=!0)},o(t){_(r.$$.fragment,t),_(a.$$.fragment,t),i=!1},d(t){t&&C(e),j(r),j(a)}}}const Ee={default:class extends ${constructor(t){super(),b(this,t,null,ie,v,{})}},workspace:class extends ${constructor(t){super(),b(this,t,null,ke,v,{})}}};function Oe(t){let e,n,r;var o=t[0];return o&&(e=new o({})),{c(){e&&k(e.$$.fragment),n=ot()},m(t,o){e&&E(e,t,o),K(t,n,o),r=!0},p(t,r){if(o!==(o=t[0])){if(e){Z();const t=e;_(t.$$.fragment,1,0,(()=>{j(t,1)})),J()}o?(e=new o({}),k(e.$$.fragment),P(e.$$.fragment,1),E(e,n.parentNode,n)):e=null}},i(t){r||(e&&P(e.$$.fragment,t),r=!0)},o(t){e&&_(e.$$.fragment,t),r=!1},d(t){t&&C(n),e&&j(e,t)}}}function Pe(t){let e,n;return e=new rt({props:{minWidth:500,$$slots:{default:[Oe]},$$scope:{ctx:t}}}),{c(){k(e.$$.fragment)},m(t,r){E(e,t,r),n=!0},p(t,n){const r={};17&n&&(r.$$scope={dirty:n,ctx:t}),e.$set(r)},i(t){n||(P(e.$$.fragment,t),n=!0)},o(t){_(e.$$.fragment,t),n=!1},d(t){j(e,t)}}}function _e(t){let e,n,r,o;return e=new tt({props:{router:we,$$slots:{default:[Pe]},$$scope:{ctx:t}}}),r=new et({props:{theme:"white",tokens:t[1]}}),{c(){k(e.$$.fragment),n=H(),k(r.$$.fragment)},m(t,s){E(e,t,s),K(t,n,s),E(r,t,s),o=!0},p(t,[n]){const r={};17&n&&(r.$$scope={dirty:n,ctx:t}),e.$set(r)},i(t){o||(P(e.$$.fragment,t),P(r.$$.fragment,t),o=!0)},o(t){_(e.$$.fragment,t),_(r.$$.fragment,t),o=!1},d(t){j(e,t),t&&C(n),j(r,t)}}}function je(t,e,n){let r,o;y(re);const s=ae,{layout:a}=oe((t=>t.app));return nt(t,a,(t=>n(3,o=t))),t.$$.update=()=>{8&t.$$.dirty&&n(0,r=Ee[o])},[r,s,a,o]}new class extends ${constructor(t){super(),b(this,t,je,_e,v,{})}}({target:document.getElementById("app")});export{it as W,Bt as a,_t as b,xt as c,Pt as d,Wt as e,Mt as f,St as g,we as r,re as s,oe as u};
